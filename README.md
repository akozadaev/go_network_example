# Примеры работы с сетью на Go

Коллекция примеров на языке Go, демонстрирующих различные аспекты сетевого программирования - от низкоуровневых протоколов (TCP, UDP) до прикладного уровня (HTTP, REST, аутентификация).

---

## Архитектура Интернета

Интернет - это глобальная сеть устройств, объединённых стандартными протоколами и технологиями. Архитектура Интернета децентрализована и включает несколько ключевых компонентов:

1. **Уровни сети (Network Layers)**: физический уровень, уровень канала, сетевой уровень, транспортный уровень (TCP, UDP), прикладной уровень (HTTP и др.)
2. **Протоколы**: TCP/IP определяет упаковку, маршрутизацию и доставку данных
3. **IP-адресация**: уникальные IPv4/IPv6 адреса для идентификации устройств
4. **DNS**: преобразование доменных имён в IP-адреса
5. **Маршрутизация**: выбор оптимального пути передачи данных
6. **Протоколы прикладного уровня**: HTTP, SMTP и др.
7. **Безопасность**: HTTPS, шифрование

---

## Содержание примеров

### 1. TCP - `1_tcp/`

Работа с пакетом `net` на **транспортном уровне** (модель OSI). TCP обеспечивает надёжную доставку данных с установлением соединения.

- **Сервер** (`server/main.go`): слушает порт 8080, принимает соединения, обрабатывает каждое в отдельной горутине, возвращает эхо-ответ
- **Клиент** (`client/main.go`): подключается к серверу, отправляет сообщения с клавиатуры, получает ответы

**Запуск:**
```bash
# Терминал 1 - сервер
cd 1_tcp/server && go run main.go

# Терминал 2 - клиент
cd 1_tcp/client && go run main.go
```

---

### 2. UDP - `2_udp/`

Работа с **UDP** (User Datagram Protocol) - протокол без установления соединения, быстрый, но без гарантии доставки.

- **Сервер** (`server/main.go`): слушает порт 8081, получает дейтаграммы, отправляет фиксированный ответ
- **Клиент** (`client/sender.sh`): отправка сообщения через `nc` (netcat)

**Запуск:**
```bash
# Терминал 1 - сервер
cd 2_udp/server && go run main.go

# Терминал 2 - клиент
./2_udp/client/sender.sh
```

---

### 3. HTTP - `3_http/`

Работа с пакетом `net/http` на **прикладном уровне**.

- **Сервер** (`server/main.go`): простой HTTP-сервер на порту 8080, обработчик `/` возвращает «Привет, мир!»
- **Клиент** (`client/main.go`): выполняет GET-запрос к внешнему API (httpbin.org), выводит статус и тело ответа

**Запуск:**
```bash
# Сервер
cd 3_http/server && go run main.go

# Клиент (отдельно или при работающем сервере - клиент обращается к httpbin.org)
cd 3_http/client && go run main.go
```

---

### 4. REST API (CRUD) - `4_rest/`

REST (Representational State Transfer) - архитектурный стиль для API. Ресурсы доступны по URI, операции выполняются HTTP-методами (GET, POST, PUT, DELETE).

- **Сервер** (`server/main.go`): REST API для сущности `User`
  - `GET /users` - список всех пользователей
  - `GET /users/{id}` - пользователь по ID
  - `POST /users` - создание пользователя (тело JSON)
- **Клиент** (`client/`): скрипты curl для тестирования API

**Запуск:**
```bash
cd 4_rest/server && go run main.go

# Тесты:
./4_rest/client/curl_get_all.sh
./4_rest/client/curl_get_by_id.sh   # изменить URL на /users/1 при необходимости
./4_rest/client/curl_get_by_create.sh
```

---

### 5. Basic Auth - `basic_auth/`

HTTP Basic Authentication - аутентификация по логину и паролю в заголовке запроса (base64).

- **Сервер** (`main.go`): эндпоинт `/admin` защищён Basic Auth (admin/secret)
- **Клиент** (`curl_client.sh`): пример запроса с учётными данными

**Запуск:**
```bash
cd basic_auth && go run main.go
./basic_auth/curl_client.sh
```

---

### 6. Cookies - `cookies/`

Работа с куками: хранение данных на стороне клиента и автоматическая отправка при запросах.

- **Сервер** (`main.go`): устанавливает и читает зашифрованную куку с помощью `gorilla/securecookie`

**Запуск:**
```bash
cd cookies && go mod tidy && go run main.go
curl http://localhost:8080/
curl -b "cookie-name=..." http://localhost:8080/  # при повторном запросе с кукой
```

---

### 7. JWT - `jwt/`

JWT (JSON Web Token) - токены для передачи утверждений между клиентом и сервером без хранения состояния на сервере.

- `main.go` - генерация JWT с коротким временем жизни (1 секунда)
- `main_check.go` - HTTP-сервер с защищённым эндпоинтом `/protected`, проверка токена из заголовка `Authorization: Bearer <token>`

**Запуск:**
```bash
cd jwt && go mod tidy

# Сгенерировать токен
go run main.go

# Запустить сервер проверки
go run main_check.go

# curl с валидным токеном (см. jwt/curl_sucses, jwt/curl_exp, jwt/curl_invalid и т.д.)
```

---

### 8. Сессии - `session/`

Управление сессиями с помощью `gorilla/sessions`: хранение данных на сервере, идентификация клиента по cookie `session_id`.

- **Сервер** (`main.go`): сохраняет значение в сессии при первом посещении и отображает его при повторных

**Запуск:**
```bash
cd session && go mod tidy && go run main.go
# Использовать скрипты из session/curls для тестирования
```

---

### 9. Swagger / OpenAPI - `swaggo_example/`

Документирование REST API с помощью Swagger (OpenAPI) и библиотеки `swaggo`.

- **Сервер** (`main.go`): REST API пользователей с аннотациями swag
- **Документация**: генерируется в `docs/`, Swagger UI доступен по `/swagger/index.html`

**Запуск:**
```bash
cd swaggo_example
go mod tidy
swag init -g main.go -o ./docs   # генерация docs
go run main.go
# Открыть http://localhost:8080/swagger/index.html
```

---

## Клиент-серверное взаимодействие

Во всех примерах используется модель «клиент - сервер»:

- **Клиент** инициирует запрос
- **Сервер** ожидает запросы и возвращает ответы
- Взаимодействие строится по протоколам: TCP, UDP, HTTP
- Каждый запрос содержит достаточно информации для обработки (REST - stateless)

---

## Модель OSI и протоколы в примерах

| Уровень OSI        | Примеры в проекте      |
|--------------------|------------------------|
| Транспортный       | TCP (1_tcp), UDP (2_udp) |
| Прикладной         | HTTP (3_http), REST (4_rest), Basic Auth, JWT, Cookies, Sessions, Swagger |

---

## Пакеты Go

- **`net`** - низкоуровневые протоколы (TCP, UDP, сокеты)
- **`net/http`** - HTTP-клиенты и серверы
- **`encoding/json`** - сериализация JSON для REST API
- **`github.com/gorilla/*`** - маршрутизация, сессии, secure cookie
- **`github.com/dgrijalva/jwt-go`** - JWT
- **`github.com/swaggo/*`** - Swagger/OpenAPI

---

## Задания для самостоятельной работы

Ниже представлены 10 заданий. Каждый студент выполняет все задания.

---

### Задание 1. TCP-сервер с подсчётом сообщений

Расширить TCP-сервер из `1_tcp/server`: добавить счётчик полученных сообщений и эндпоинт (через отдельное служебное соединение или дополнительный порт), по которому можно получить текущее количество сообщений. Использовать `sync/atomic` или `sync.Mutex` для потокобезопасности.

---

### Задание 2. UDP-клиент на Go

Написать UDP-клиент на Go (аналог `sender.sh`) для `2_udp/server`. Клиент должен отправлять строку, введённую с клавиатуры, и выводить ответ сервера. Использовать `net.DialUDP`.

---

### Задание 3. HTTP-сервер с несколькими маршрутами

Расширить `3_http/server`: добавить маршруты `/health` (возвращает статус 200 и JSON `{"status":"ok"}`) и `/time` (возвращает текущее время сервера в ISO 8601). Обеспечить корректный `Content-Type`.

---

### Задание 4. REST API: операции PUT и DELETE

Добавить в `4_rest/server` поддержку:
- `PUT /users/{id}` - обновление пользователя (имя из JSON тела запроса)
- `DELETE /users/{id}` - удаление пользователя

Добавить соответствующие curl-скрипты для тестирования.

---

### Задание 5. Basic Auth с несколькими пользователями

Расширить `basic_auth`: хранить пары логин/пароль в map и проверять их при запросе. Добавить минимум 3 пользователя с разными правами (можно выводить разные сообщения в зависимости от логина).

---

### Задание 6. Cookies: счётчик посещений

Изменить `cookies`: вместо одного значения хранить счётчик посещений страницы. При каждом запросе увеличивать счётчик и выводить: «Вы посетили страницу N раз».

---

### Задание 7. JWT с ролями

Расширить `jwt`: добавить в claims поле `role` (admin/user). В `main_check.go` проверять роль и для `admin` возвращать «Admin panel», для `user` - «User area». Добавить эндпоинт `/login`, который принимает JSON `{"username","password"}` и возвращает JWT (упрощённая проверка - без БД).

---

### Задание 8. Сессии: аутентификация

Расширить `session`: реализовать простой вход по логину и паролю. При успешном входе сохранять в сессии `username`, при обращении к защищённой странице проверять наличие `username` в сессии. Добавить маршрут `/logout` для выхода (удаление сессии).

---

### Задание 9. Swagger: добавить эндпоинт

В `swaggo_example` добавить эндпоинт `DELETE /users/{id}` с соответствующей swag-аннотацией. Выполнить `swag init` и убедиться, что новый метод отображается в Swagger UI.

---

### Задание 10. Комбинированный: REST + Basic Auth

Объединить идеи из `4_rest` и `basic_auth`: REST API пользователей должно быть защищено Basic Auth. Все операции (GET, POST, PUT, DELETE) доступны только при корректной аутентификации. Добавить curl-примеры с `-u user:pass`.

---

## Требования к выполнению заданий

1. Код на Go, стиль - идиоматичный
2. Обработка ошибок при сетевых операциях
3. Краткий README или комментарии по запуску изменённого примера
4. При необходимости - `go mod tidy` и обновление зависимостей

---

## Дополнительные материалы

- [Документация пакета net](https://pkg.go.dev/net)
- [Документация net/http](https://pkg.go.dev/net/http)
- [REST API Best Practices](https://restfulapi.net/)
- [JWT.io](https://jwt.io/)
- [Swaggo](https://github.com/swaggo/swag)
- [OWASP Top Ten](https://owasp.org/www-project-top-ten/) - базовые уязвимости веб-приложений
